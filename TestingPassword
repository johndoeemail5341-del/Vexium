<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <base target="_top">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
    html,body{
      height:100%;margin:0;overflow:hidden;background:#f3f4f6;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#0f172a;
    }

    /* ===== Namecard ===== */
    .user-chip{
      position:fixed;top:14px;left:14px;display:inline-flex;align-items:center;gap:10px;
      padding:8px 10px;border:1px solid #e5e7eb;border-radius:12px;
      background:#fff;box-shadow:0 8px 20px rgba(2,6,23,.08);
      z-index:9999;display:none;width:220px;
    }
    .user-chip img{
      width:36px;height:36px;border-radius:10px;object-fit:cover;
      background:#f1f5f9;border:1px solid #e5e7eb;
    }
    .user-chip .user-text{line-height:1.05;overflow:hidden;}
    .user-chip .name-line{font-weight:800;font-size:.95rem;color:#111827;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;}
    .user-chip .email-line{font-size:.8rem;color:#64748b;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;}

    /* ===== Time box ===== */
    .time-box{
      position:fixed;top:78px;left:14px;
      width:220px;
      padding:6px 0;border:1px solid #e5e7eb;border-radius:12px;
      background:#fff;box-shadow:0 8px 20px rgba(2,6,23,.08);
      text-align:center;font-weight:700;font-size:1rem;color:#111827;
      z-index:9998;display:none;
    }

    /* ===== Modal ===== */
    .wrap{height:100%;width:100%;display:grid;place-items:center;padding:24px;box-sizing:border-box;}
    .alert{
      width:min(560px,92%);background:#fff;border:1px solid #e5e7eb;border-radius:14px;
      box-shadow:0 20px 60px rgba(2,6,23,.12);padding:28px 24px;text-align:center;
      transition:opacity .25s ease,transform .25s ease;
    }
    .hdr{display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:10px;}
    .icon{width:42px;height:42px;border-radius:12px;display:grid;place-items:center;
      background:#f8fafc;border:1px solid #e5e7eb;}
    .title{margin:0;font-size:1.25rem;font-weight:800;}
    .desc{margin:6px 0 16px;color:#475569;font-size:.98rem;}
    .form{display:flex;flex-direction:column;align-items:center;gap:10px;}
    .input{
      width:280px;height:40px;border:1px solid #e5e7eb;border-radius:10px;
      background:#f9fafb;padding:0 12px;font-size:1rem;outline:none;
      transition:border-color .12s ease,background .12s ease;text-align:center;
    }
    .input:focus{border-color:#cbd5e1;background:#fff;}
    .btn{
      width:140px;height:40px;border:1px solid #e5e7eb;border-radius:10px;
      background:#111827;color:#fff;font-weight:800;letter-spacing:.3px;
      cursor:pointer;user-select:none;transition:transform .06s ease,opacity .12s ease;
    }
    .btn:hover{opacity:.96;} .btn:active{transform:translateY(1px);}
    .btn:disabled{opacity:.6;cursor:not-allowed;}
    .status{margin-top:12px;font-size:.98rem;color:#6b7280;min-height:1.25em;}
    .status.ok{color:#166534;} .status.bad{color:#b91c1c;} .status.chk{color:#374151;}

    /* ===== Hello animation ===== */
    .hello{
      position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) translateY(10px);
      font-size:3rem;font-weight:800;letter-spacing:.5px;opacity:0;
      transition:opacity 600ms ease,transform 600ms ease;
      pointer-events:none;will-change:opacity,transform;
    }
    .hello.enter{opacity:1;transform:translate(-50%,-50%) translateY(0);}
    .hello.leave{opacity:0;transform:translate(-50%,-50%) translateY(-80px);}
  </style>
</head>
<body>
  <!-- NAMECARD (hidden until success) -->
  <div id="userChip" class="user-chip" aria-live="polite">
    <img id="userImg" alt="">
    <div class="user-text">
      <div id="userName" class="name-line"></div>
      <div id="userEmail" class="email-line"></div>
    </div>
  </div>

  <!-- TIME BOX (hidden until success) -->
  <div id="timeBox" class="time-box">--:--:--</div>

  <!-- MODAL -->
  <div class="wrap">
    <div id="alert" class="alert" role="dialog" aria-labelledby="t" aria-modal="true">
      <div class="hdr">
        <div class="icon" aria-hidden="true">
          <!-- Lock icon -->
          <svg viewBox="0 0 24 24" width="22" height="22" fill="none"
               stroke="#334155" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3.5" y="10" width="17" height="10.5" rx="2.5"></rect>
            <path d="M7.5 10V7a4.5 4.5 0 1 1 9 0v3"></path>
          </svg>
        </div>
        <h1 id="t" class="title">Vexium</h1>
      </div>
      <p class="desc">This console is password protected.</p>

      <div class="form">
        <input id="pw" class="input" type="password" placeholder="passphrase" autocomplete="current-password">
        <button id="go" class="btn" type="button">Enter</button>
      </div>
      <div id="status" class="status" aria-live="polite">Waiting…</div>
    </div>
  </div>

  <!-- Hello animation -->
  <div id="hello" class="hello" aria-hidden="true">hello</div>

  <script>
  /* keep your existing helpers/variables above … */

  function submit(){
    const v = (pw.value || "").trim();
    if(!v){ setStatus("bad","Please enter a passphrase."); return; }
    setStatus("chk","checking…"); setBusy?.(true);

    google.script.run
      .withSuccessHandler(res=>{
        // res: { ok, pwOk, driveOk }
        if (res && res.ok) {
          // SUCCESS → remove barrier (keep your success flow)
          if (alertBox) {
            alertBox.style.opacity="0"; alertBox.style.transform="scale(.98)";
            setTimeout(()=>{ alertBox.style.visibility="hidden"; }, 250);
          }
          if (typeof playHelloSequence === "function") playHelloSequence();
          if (typeof loadNameCard === "function") loadNameCard();
          if (typeof startClockOnce === "function") startClockOnce();
        } else {
          // FAILED → show the right message
          if (res && res.pwOk && !res.driveOk) {
            setStatus("bad", "you are not authenticated");
          } else {
            setStatus("bad", "incorrect password");
          }
          setBusy?.(false);
        }
      })
      .withFailureHandler(()=>{
        setStatus("", "checking failed — try again");
        setBusy?.(false);
      })
      .authenticate(v);
  }

  /* keep your existing event listeners */
</script>
</body>
</html>
