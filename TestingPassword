<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <base target="_top">
    <style>
      :root {
        --ok: #16a34a;         /* green-600 */
        --bad: #dc2626;        /* red-600 */
        --muted: #6b7280;      /* gray-500 */
        --border: #e5e7eb;     /* gray-200 */
      }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; padding: 16px; line-height: 1.4; }
      .card { border: 1px solid var(--border); border-radius: 10px; padding: 14px; }
      h3 { margin: 0 0 8px 0; }
      p.desc { margin: 0 0 12px 0; color: var(--muted); font-size: 0.95rem; }
      .row { display: flex; gap: 8px; margin: 10px 0 6px; }
      input[type="password"] { flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 0.95rem; }
      button { padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px; cursor: pointer; background: white; }
      button:disabled { opacity: 0.6; cursor: not-allowed; }
      .status { margin-top: 8px; font-size: 0.95rem; }
      .status.checking { color: var(--muted); }
      .status.ok { color: var(--ok); }
      .status.bad { color: var(--bad); }
    </style>
  </head>
  <body>
    <div class="card">
      <h3>Password</h3>
      <p class="desc">This console is password protected.</p>

      <div class="row">
        <input id="pw" type="password" placeholder="Enter password" autocomplete="current-password" />
        <button id="go">Submit</button>
      </div>

      <!-- Live status line -->
      <div id="status" class="status" aria-live="polite">Waiting…</div>
    </div>

    <script>
      const $ = (id) => document.getElementById(id);
      const pwInput = $("pw");
      const goBtn = $("go");
      const statusEl = $("status");

      function setStatus(text, className) {
        statusEl.textContent = text;
        statusEl.className = "status " + (className || "");
      }
      function setBusy(busy) {
        goBtn.disabled = busy;
        pwInput.disabled = busy;
      }

      function submitPassword() {
        const value = (pwInput.value || "").trim();
        setStatus("checking…", "checking");
        setBusy(true);

        google.script.run
          .withSuccessHandler(function(ok) {
            if (ok) {
              setStatus("correct", "ok");
            } else {
              setStatus("incorrect password", "bad");
            }
            setBusy(false);
          })
          .withFailureHandler(function() {
            setStatus("checking failed — try again", "checking");
            setBusy(false);
          })
          .checkPassword(value);
      }

      goBtn.addEventListener("click", submitPassword);
      pwInput.addEventListener("keydown", function(e) { if (e.key === "Enter") submitPassword(); });
    </script>
  </body>
</html>
